#include <SPI.h>
#include <nRF24L01.h>
#include <RF24.h>
const byte addr[] = "1Node";
RF24 RF(9,10);//ce,csn
struct Signal{
  byte thro;
  byte rudd;
  byte elev;
  byte aile;};

Signal data;  

void Reset(){
  data.thro = 127;//中立點
  data.rudd = 127;
  data.elev = 127;
  data.aile = 127;}

void setup() {
 RF.begin();
 RF.setChannel(83);//頻道編號
 RF.openWritingPipe(addr);//通道地址
 RF.setPALevel(RF24_PA_MIN);//功率
 RF.setDataRate(RF24_250KBPS);//速率
 RF.stopListening();//停止接收改發射
 Reset();
}

int channelvalues(int channel,int minimum,int middle, int maximum,bool reverse){
  channel=constrain(channel,minimum,maximum);
  if(channel<middle){
    channel=map(channel,minimum,middle,0,128);}
  else {
    channel=map(channel,middle,maximum,128,255);}  

    return(reverse ? 255-channel:channel);//正反轉
  }

void loop() {
  data.thro = channelvalues(analogRead(A0),0,512,1023,false);//油門
  data.rudd = channelvalues(analogRead(A1),0,512,1023,true);//舵
  data.elev = channelvalues(analogRead(A2),0,512,1023,true);//升降舵
  data.aile = channelvalues(analogRead(A3),0,512,1023,true);//襟翼
  
  RF.write(&data,sizeof(Signal));

}